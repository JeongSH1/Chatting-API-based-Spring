{"ast":null,"code":"import { createApi, fetchBaseQuery } from \"@reduxjs/toolkit/query/react\";\nimport { setCredentials, logout } from \"../../features/auth/authSlice\";\nconst baseQuery = fetchBaseQuery({\n  baseUrl: 'http://localhost:8080',\n  mode: 'no-cors',\n  credentials: 'include',\n  prepareHeaders: (headers, _ref) => {\n    let {\n      getState\n    } = _ref;\n    const token = getState().auth.token;\n    console.log(headers);\n    if (token) {\n      headers.set(\"authorization\", `Bearer ${token}`);\n    }\n    return headers;\n  }\n});\nconst baseQueryWithReAuth = async (args, api, extraOptions) => {\n  var _result, _result$error;\n  let result = await baseQuery(args, api, extraOptions);\n  if (((_result = result) === null || _result === void 0 ? void 0 : (_result$error = _result.error) === null || _result$error === void 0 ? void 0 : _result$error.originalStatus) === 403) {\n    console.log(\"sending refresh token\");\n    const refreshResult = await baseQuery('/refresh', api, extraOptions);\n    console.log(refreshResult);\n    if (refreshResult !== null && refreshResult !== void 0 && refreshResult.data) {\n      const user = api.getState().auth.user;\n      api.dispatch(setCredentials({\n        ...refreshResult.data,\n        user\n      }));\n      result = await baseQuery(args, api, extraOptions);\n    } else {\n      api.dispatch(logout());\n    }\n  }\n  return result;\n};\nexport const apiSlice = createApi({\n  baseQuery: baseQueryWithReAuth,\n  endpoints: () => ({})\n});","map":{"version":3,"names":["createApi","fetchBaseQuery","setCredentials","logout","baseQuery","baseUrl","mode","credentials","prepareHeaders","headers","_ref","getState","token","auth","console","log","set","baseQueryWithReAuth","args","api","extraOptions","_result","_result$error","result","error","originalStatus","refreshResult","data","user","dispatch","apiSlice","endpoints"],"sources":["/Users/jeongseho/Documents/spring-react2/src/main/frontend/src/app/api/apiSlice.js"],"sourcesContent":["import { createApi, fetchBaseQuery } from \"@reduxjs/toolkit/query/react\";\nimport { setCredentials, logout } from \"../../features/auth/authSlice\";\n\nconst baseQuery = fetchBaseQuery({\n    baseUrl: 'http://localhost:8080',\n    mode: 'no-cors',\n    credentials: 'include',\n    prepareHeaders: (headers, {getState}) => {\n        const token = getState().auth.token\n        console.log(headers)\n        if (token) {\n            headers.set(\"authorization\", `Bearer ${token}`)\n        }\n        return headers\n    }\n})\n\nconst baseQueryWithReAuth = async (args, api, extraOptions) => {\n    let result = await baseQuery(args, api, extraOptions)\n\n    if (result?.error?.originalStatus === 403) {\n        console.log(\"sending refresh token\")\n        const refreshResult = await baseQuery('/refresh', api, extraOptions)\n        console.log(refreshResult)\n        if (refreshResult?.data) {\n            const user = api.getState().auth.user\n            api.dispatch(setCredentials({...refreshResult.data, user}))\n            result = await baseQuery(args, api, extraOptions)\n        } else {\n            api.dispatch(logout())\n        }\n    }\n    return result\n}\n\nexport const apiSlice = createApi({\n    baseQuery: baseQueryWithReAuth,\n    endpoints: () => ({}),\n})\n\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,cAAc,QAAQ,8BAA8B;AACxE,SAASC,cAAc,EAAEC,MAAM,QAAQ,+BAA+B;AAEtE,MAAMC,SAAS,GAAGH,cAAc,CAAC;EAC7BI,OAAO,EAAE,uBAAuB;EAChCC,IAAI,EAAE,SAAS;EACfC,WAAW,EAAE,SAAS;EACtBC,cAAc,EAAEA,CAACC,OAAO,EAAAC,IAAA,KAAiB;IAAA,IAAf;MAACC;IAAQ,CAAC,GAAAD,IAAA;IAChC,MAAME,KAAK,GAAGD,QAAQ,CAAC,CAAC,CAACE,IAAI,CAACD,KAAK;IACnCE,OAAO,CAACC,GAAG,CAACN,OAAO,CAAC;IACpB,IAAIG,KAAK,EAAE;MACPH,OAAO,CAACO,GAAG,CAAC,eAAe,EAAG,UAASJ,KAAM,EAAC,CAAC;IACnD;IACA,OAAOH,OAAO;EAClB;AACJ,CAAC,CAAC;AAEF,MAAMQ,mBAAmB,GAAG,MAAAA,CAAOC,IAAI,EAAEC,GAAG,EAAEC,YAAY,KAAK;EAAA,IAAAC,OAAA,EAAAC,aAAA;EAC3D,IAAIC,MAAM,GAAG,MAAMnB,SAAS,CAACc,IAAI,EAAEC,GAAG,EAAEC,YAAY,CAAC;EAErD,IAAI,EAAAC,OAAA,GAAAE,MAAM,cAAAF,OAAA,wBAAAC,aAAA,GAAND,OAAA,CAAQG,KAAK,cAAAF,aAAA,uBAAbA,aAAA,CAAeG,cAAc,MAAK,GAAG,EAAE;IACvCX,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC;IACpC,MAAMW,aAAa,GAAG,MAAMtB,SAAS,CAAC,UAAU,EAAEe,GAAG,EAAEC,YAAY,CAAC;IACpEN,OAAO,CAACC,GAAG,CAACW,aAAa,CAAC;IAC1B,IAAIA,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEC,IAAI,EAAE;MACrB,MAAMC,IAAI,GAAGT,GAAG,CAACR,QAAQ,CAAC,CAAC,CAACE,IAAI,CAACe,IAAI;MACrCT,GAAG,CAACU,QAAQ,CAAC3B,cAAc,CAAC;QAAC,GAAGwB,aAAa,CAACC,IAAI;QAAEC;MAAI,CAAC,CAAC,CAAC;MAC3DL,MAAM,GAAG,MAAMnB,SAAS,CAACc,IAAI,EAAEC,GAAG,EAAEC,YAAY,CAAC;IACrD,CAAC,MAAM;MACHD,GAAG,CAACU,QAAQ,CAAC1B,MAAM,CAAC,CAAC,CAAC;IAC1B;EACJ;EACA,OAAOoB,MAAM;AACjB,CAAC;AAED,OAAO,MAAMO,QAAQ,GAAG9B,SAAS,CAAC;EAC9BI,SAAS,EAAEa,mBAAmB;EAC9Bc,SAAS,EAAEA,CAAA,MAAO,CAAC,CAAC;AACxB,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}